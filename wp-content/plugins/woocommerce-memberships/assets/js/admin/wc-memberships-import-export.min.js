"use strict";function _defineProperty(e,s,r){return s in e?Object.defineProperty(e,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[s]=r,e}(function(){var l=[].indexOf;jQuery(document).ready(function(c){var s,r,t,_,i,m,e,a,o,n,p,d;if(d=null!=(o=window.wc_memberships_admin)?o:{},"admin_page_wc_memberships_import_export"===(a=null!=(n=window.pagenow)?n:"")&&(c(".js-user-membership-date").datepicker({defaultDate:"",dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0,showOn:"button",buttonImage:d.calendar_image,buttonImageOnly:!0}),r=c("#wc_memberships_members_csv_import_create_new_user_memberships"),e=c("#wc_memberships_members_csv_import_merge_existing_user_memberships"),s=c("#wc_memberships_members_csv_import_allow_memberships_transfer").closest("fieldset"),_=c("#wc_memberships_members_csv_import_create_new_users"),t=_.closest("fieldset"),m=c("#wc_memberships_members_csv_import_new_user_email_notification").closest("fieldset"),i=c("#wc_memberships_members_csv_import_default_start_date").closest("tr"),r.on("change",function(e){return c(this).is(":checked")?(i.show(),t.show(),_.is(":checked")?m.show():m.hide()):(i.hide(),t.hide(),m.hide())}).trigger("change"),_.on("change",function(e){return c(this).is(":checked")&&r.is(":checked")?m.show():m.hide()}).trigger("change"),e.on("change",function(e){return c(this).is(":checked")?s.show():s.hide()}).trigger("change")),"admin_page_wc_memberships_import_export"===a||"edit-wc_user_membership"===a||"wc_user_membership"===a)return c("button#wc-memberships-import-export-trigger").on("click",function(e){return e.preventDefault(),p(c(this).data("action-id"),c(this).data("action-title"))}),c("#doaction, #doaction2").on("click",function(e){var s;return e.preventDefault(),"export"!==c(this).prev("select").val()||(s=c('input[type="checkbox"][name="post\\[\\]"]:checked').map(function(){return this.value}).get(),p("export",d.i18n.export_user_memberships,0===s.length?"undefined":s))}),p=function(s,r,e){var t,_,i,m,a,o,n,p=2<arguments.length&&void 0!==e?e:[];return"import"===s?(t=c("#wc-memberships-import-export-trigger"),_=t.next("span"),(m=0<(a=c("#wc_memberships_members_csv_import_file").prop("files")).length?a[0]:null)?(t.prop("disabled",!0),_.addClass("is-active"),(o=new FormData).append("action","wc_memberships_import_user_memberships"),o.append("security",d.import_user_memberships_nonce),o.append("file",m),o.append("create_new_memberships",c("#wc_memberships_members_csv_import_create_new_user_memberships").is(":checked")?"yes":"no"),o.append("merge_existing_memberships",c("#wc_memberships_members_csv_import_merge_existing_user_memberships").is(":checked")?"yes":"no"),o.append("allow_memberships_transfer",c("#wc_memberships_members_csv_import_allow_memberships_transfer").is(":checked")?"yes":"no"),o.append("create_new_users",c("#wc_memberships_members_csv_import_create_new_users").is(":checked")?"yes":"no"),o.append("notify_new_users",c("#wc_memberships_members_csv_import_new_user_email_notification").is(":checked")?"yes":"no"),o.append("timezone",c("#wc_memberships_members_csv_import_timezone").val()),o.append("default_start_date",c("#wc_memberships_members_csv_import_default_start_date").val()),o.append("fields_delimiter",c("#wc_memberships_members_csv_import_fields_delimiter").val()),n=["wc_memberships_members_csv_import_create_new_user_memberships","wc_memberships_members_csv_import_merge_existing_user_memberships","wc_memberships_members_csv_import_new_user_email_notification"],c("select, input, textarea").each(function(){var e,s;if((s=(e=c(this).attr("id")||"").replace("wc_memberships_members_csv_import_",""))&&!o.has(s)&&l.call(n,e)<0)return"checkbox"===c(this).attr("type")?o.append(e,c(this).is(":checked")?"yes":"no"):o.append(e,c(this).val())}),c.ajax({url:d.ajax_url,type:"POST",data:o,contentType:!1,processData:!1,success:function(e){return t.prop("disabled",!1),_.removeClass("is-active"),new WC_Memberships_Modal_Import_Export_User_Memberships({data:{job:e.success&&e.data?e.data:{},error:!e.success&&e.data?e.data:null,action:{id:s,title:r}}})},error:function(e){return t.prop("disabled",!1),_.removeClass("is-active"),new WC_Memberships_Modal_Import_Export_User_Memberships({data:{job:null,error:e.data?e.data:null,action:{id:s,title:r}}})}})):alert(d.i18n.import_file_missing)):"export"===s?(i={action:"wc_memberships_export_user_memberships",security:d.export_user_memberships_nonce,export_params:{user_membership_ids:p,plan_ids:c("#wc_memberships_members_csv_export_plan").val(),plan_statuses:c("#wc_memberships_members_csv_export_status").val(),start_date_from:c("#wc_memberships_members_csv_export_start_date_from").val(),start_date_to:c("#wc_memberships_members_csv_export_start_date_to").val(),end_date_from:c("#wc_memberships_members_csv_export_end_date_from").val(),end_date_to:c("#wc_memberships_members_csv_export_end_date_to").val(),fields_delimiter:c("#wc_memberships_members_csv_export_fields_delimiter").val(),include_meta:c("#wc_memberships_members_csv_export_meta_data").is(":checked")?"yes":"no"}},n=["wc_memberships_members_csv_export_plan","wc_memberships_members_csv_export_status","wc_memberships_members_csv_export_meta_data"],c("select, input, textarea").each(function(){var e,s;if((s=(e=c(this).attr("id")||"").replace("wc_memberships_members_csv_export_",""))&&l.call(i.export_params,s)<0&&l.call(n,e)<0)return"checkbox"===c(this).attr("type")?c.extend(i.export_params,_defineProperty({},""+s,c(this).is(":checked")?"yes":"no")):c.extend(i.export_params,_defineProperty({},""+s,c(this).val()))}),c.post(d.ajax_url,i,function(e){return e.data?new WC_Memberships_Modal_Import_Export_User_Memberships({data:{job:e.success?e.data:null,error:e.success?null:e.data,action:{id:s,title:r}}}):console.log(e)})):void 0},window.WC_Memberships_Modal_Import_Export_User_Memberships=WC_Memberships_Modal_View.extend({template_id:"wc-memberships-modal-import-export-user-memberships",initialize:function(e){var s,r,t,_,i;if(i=this,s=e.data.action,r=e.data.job?e.data.job:null,_=e.data.error?e.data.error:null,WC_Memberships_Modal_Import_Export_User_Memberships.__super__.initialize.apply(this,arguments),c("#wc-memberships-modal-import-export-user-memberships").find("h1").text(s.title),i.unblock(),_&&(window.onbeforeunload=null),r){if(window.onbeforeunload=function(){return"export"===s.id?d.i18n.confirm_export_cancel:"import"===s.id?d.i18n.confirm_import_cancel:void 0},"completed"!==r.status)return t={action:"wc_memberships_get_batch_job",security:d.get_memberships_batch_job_nonce,job_name:r.name,job_id:r.id,process:!0},c.post(d.ajax_url,t,function(e){return e.data?(i.close(),new WC_Memberships_Modal_Import_Export_User_Memberships({data:{job:e.success?e.data:null,error:e.success?null:e.data,action:{id:s.id,title:s.title}}})):console.log(e)});if(window.onbeforeunload=null,"export"===s.id&&0<parseInt(r.results.exported,10)&&r.download_url)return window.location.href=r.download_url}}})})}).call(void 0);